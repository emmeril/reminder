<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reminder Manager</title>
  <!-- Bootstrap CSS -->
  <link
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Alpine.js -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.3/cdn.js"></script>
</head>
<body>
  <div class="container mt-5" x-data="reminderApp()">
    <h1 class="mb-4">Reminder Manager</h1>

    <!-- Form untuk menambah pengingat -->
    <div class="card mb-4">
      <div class="card-header">Tambah Pengingat</div>
      <div class="card-body">
        <form @submit.prevent="addReminder">
          <div class="form-group">
            <label for="phoneNumber">Nomor Telepon</label>
            <input
              type="text"
              id="phoneNumber"
              class="form-control"
              x-model="newReminder.phoneNumber"
              placeholder="Masukkan nomor telepon"
              required
            />
          </div>
          <div class="form-group">
            <label for="paymentDate">Tanggal Pembayaran</label>
            <input
              type="date"
              id="paymentDate"
              class="form-control"
              x-model="newReminder.paymentDate"
              required
            />
          </div>
          <div class="form-group">
            <label for="reminderTime">Waktu Pengingat</label>
            <input
              type="time"
              id="reminderTime"
              class="form-control"
              x-model="newReminder.reminderTime"
              required
            />
          </div>
          <div class="form-group">
            <label for="message">Pesan</label>
            <textarea
              id="message"
              class="form-control"
              x-model="newReminder.message"
              placeholder="Masukkan pesan pengingat"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Tambah Pengingat</button>
        </form>
      </div>
    </div>

    <!-- Daftar pengingat -->
    <div class="card">
      <div class="card-header">Daftar Pengingat</div>
      <div class="card-body">
        <ul class="list-group">
          <li class="list-group-item" x-for="reminder in reminders" :key="reminder.id">
            <div>
              <strong>{{ reminder.phoneNumber }}</strong> - {{ reminder.message }}
              <br />
              <small>{{ reminder.reminderDateTime }}</small>
            </div>
            <div class="mt-2">
              <button class="btn btn-danger btn-sm" @click="deleteReminder(reminder.id)">
                Hapus
              </button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // Alpine.js component
    function reminderApp() {
      return {
        reminders: [],
        newReminder: {
          phoneNumber: '',
          paymentDate: '',
          reminderTime: '',
          message: ''
        },

        // Fetch reminders from backend
        async fetchReminders() {
          try {
            const response = await fetch('http://localhost:3000/get-reminders');
            const data = await response.json();
            this.reminders = data.reminders; // Set reminders from response
          } catch (error) {
            console.error('Error fetching reminders:', error);
          }
        },

        // Add a new reminder
        async addReminder() {
          try {
            const reminderData = {
              phoneNumber: this.newReminder.phoneNumber,
              paymentDate: this.newReminder.paymentDate,
              reminderTime: this.newReminder.reminderTime,
              message: this.newReminder.message,
            };

            const response = await fetch('http://localhost:3000/schedule-reminder', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(reminderData),
            });

            const data = await response.json();
            if (response.ok) {
              this.reminders.push(data.reminder);
              // Reset form
              this.newReminder = {
                phoneNumber: '',
                paymentDate: '',
                reminderTime: '',
                message: ''
              };
            } else {
              alert(data.message);
            }
          } catch (error) {
            console.error('Error adding reminder:', error);
          }
        },

        // Delete a reminder
        async deleteReminder(id) {
          try {
            const response = await fetch(`http://localhost:3000/delete-reminder/${id}`, {
              method: 'DELETE',
            });

            const data = await response.json();
            if (response.ok) {
              this.reminders = this.reminders.filter(reminder => reminder.id !== id);
            } else {
              alert(data.message);
            }
          } catch (error) {
            console.error('Error deleting reminder:', error);
          }
        },

        // Initialize component
        init() {
          this.fetchReminders(); // Fetch reminders when the component is initialized
        }
      };
    }
  </script>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
